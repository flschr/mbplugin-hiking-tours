{{ define "main" }}
<article class="tours-archive">
  <header>
    <h1>{{ .Title | default "Tours" }}</h1>
    {{ with .Content }}
    <div>
      {{ . }}
    </div>
    {{ end }}
  </header>

  {{- if .Site.Data.tours -}}
    {{- $count := len .Site.Data.tours -}}
    {{- $totalKm := 0.0 -}}
    {{- $totalHm := 0 -}}
    {{- range .Site.Data.tours -}}
      {{- if .distance_km -}}
        {{- $totalKm = add $totalKm .distance_km -}}
      {{- end -}}
      {{- if .elevation_m -}}
        {{- $totalHm = add $totalHm .elevation_m -}}
      {{- end -}}
    {{- end -}}
    <p>
      {{ $count }} Tour{{ if ne $count 1 }}s{{ end }} · {{ printf "%.1f" $totalKm }} km · {{ $totalHm }} hm
    </p>
    <ul>
      {{- range .Site.Data.tours -}}
      <li>
        <h3>
          {{- if .post_url -}}
            <a href="{{ .post_url | htmlEscape }}">{{ .title | htmlEscape }}</a>
          {{- else -}}
            {{ .title | htmlEscape }}
          {{- end -}}
        </h3>
        <p>
          {{- $meta := slice -}}
          {{- if .date -}}
            {{- $parsedDate := time.AsTime .date -}}
            {{- $meta = $meta | append ($parsedDate.Format "02.01.2006") -}}
          {{- end -}}
          {{- if .region -}}
            {{- $meta = $meta | append (.region | htmlEscape) -}}
          {{- end -}}
          {{- if .type -}}
            {{- $label := .type -}}
            {{- if eq .type "hike" -}}{{ $label = "Hike" -}}{{ end -}}
            {{- if eq .type "mtb" -}}{{ $label = "MTB" -}}{{ end -}}
            {{- if eq .type "gravel" -}}{{ $label = "Gravel" -}}{{ end -}}
            {{- if eq .type "run" -}}{{ $label = "Run" -}}{{ end -}}
            {{- $meta = $meta | append $label -}}
          {{- end -}}
          {{- if .distance_km -}}
            {{- $meta = $meta | append (printf "%.2f km" .distance_km) -}}
          {{- end -}}
          {{- if .elevation_m -}}
            {{- $meta = $meta | append (printf "%d hm" .elevation_m) -}}
          {{- end -}}
          {{- if .duration_h -}}
            {{- $meta = $meta | append (printf "%.1f h" .duration_h) -}}
          {{- end -}}
          {{- delimit $meta " · " -}}
        </p>
        {{- if .gpx -}}
        <p><a href="{{ .gpx | htmlEscape }}">GPX</a></p>
        {{- end -}}
      </li>
      {{- end -}}
    </ul>
  {{- else -}}
    <p>Noch keine Touren erfasst.</p>
  {{- end -}}
</article>
{{ end }}
